// ==========================================
// UPDATE TAMPILAN DASHBOARD (SIMPLE VERSION)
// ==========================================
const sendMainMenu = async (chatId, userId, name, messageId = null) => {
    const userData = getUserData(userId);
    const totalUsers = Object.keys(userBalance).length;
    
    // Perhitungan Statistik (Sama seperti sebelumnya)
    let day = 0, month = 0, total = 0;
    const tgl = new Date().toLocaleDateString('id-ID');
    const bln = (new Date().getMonth() + 1) + "-" + new Date().getFullYear();
    historyTrx.forEach(t => {
        total += t.amount || 0;
        const d = new Date(t.date);
        if (d.toLocaleDateString('id-ID') === tgl) day += t.amount || 0;
        if (((d.getMonth() + 1) + "-" + d.getFullYear()) === bln) month += t.amount || 0;
    });

    const menuMsg = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ        âœ¨ **WELCOME** âœ¨        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
à¹‘âš™ï¸à¹‘ *${name}*
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ **Role** : ${userData.role.toUpperCase()}
ğŸ’° **Saldo** : ${formatRupiah(userData.balance)}
â³ **Runtime** : ${getRuntime()}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š **Stats Bot:**
ğŸ‘¥ User: ${totalUsers} | ğŸŒ TRX: ${formatRupiah(total)}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ *Owner:* @AJW29`;

    const opts = {
        parse_mode: 'Markdown',
        reply_markup: {
            inline_keyboard: [
                // Baris 1: Transaksi Utama
                [{ text: 'MENU', callback_data: 'menu_semua_fitur' }],
                // Baris 3: Sosmed
            ]
        }
    };

    if (messageId) return bot.editMessageText(menuMsg, { chat_id: chatId, message_id: messageId, ...opts }).catch(()=>{});
    bot.sendMessage(chatId, menuMsg, opts);
};

// ==========================================
// CALLBACK UNTUK MENU SATU KESATUAN
// ==========================================
bot.on('callback_query', async (clb) => {
    const chatId = clb.message.chat.id;
    const userId = clb.from.id;
    const data = clb.data;

    // Tambahkan logika ini di dalam bot.on('callback_query')
    if (data === 'menu_semua_fitur') {
        const featureOpts = {
            chat_id: chatId,
            message_id: clb.message.message_id,
            parse_mode: 'Markdown',
            reply_markup: {
                inline_keyboard: [
                    [{ text: 'ğŸ Program Referral', callback_data: 'menu_referral' }],
                    [{ text: 'ğŸ“œ Riwayat Transaksi', callback_data: 'menu_history' }],
                    [{ text: 'ğŸ‘‘ Upgrade Reseller', callback_data: 'menu_reseller' }],
                    [{ text: 'ğŸ‘¤ Menu Owner', callback_data: 'menu_owner' }],
                    [{ text: 'ğŸ”™ KEMBALI KE HOME', callback_data: 'back_to_menu' }]
                ]
            }
        };
        return bot.editMessageText("ğŸ› ï¸ *PUSAT FITUR FANTUNNEL*\nSilakan pilih fitur yang ingin digunakan:", featureOpts);
    }
    
    // Callback lainnya (back_to_menu, menu_referral, dll tetap sama)
});
